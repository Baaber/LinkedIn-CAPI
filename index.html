<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0FKG7GCFY0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-0FKG7GCFY0');
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MM6N3HBJ');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Demo</title>

    <style>
        #consoleOutput {
            width: 100%;
            height: 200px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-y: auto;
        }
        .heading {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .dotted-line {
            border-bottom: 1px dotted #000;
            margin-bottom: 10px;
        }
    </style>

    <script>
        async function hashEmail(email) {
            const encoder = new TextEncoder();
            const data = encoder.encode(email.toLowerCase());
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function updateHashedEmail() {
            const emailInput = document.getElementById('email').value;
            const hashedEmail = await hashEmail(emailInput);
            document.getElementById('hashed_email').value = hashedEmail;
        }

        function setLiFatId() {
            const li_fat_id = (new URLSearchParams(window.location.search)).get("li_fat_id");
            document.getElementById('li_fat_id').value = li_fat_id;
        }

        function displayDataLayer() {
            const dataLayerEvent = {
                event: "CAPI Page View",
                dataLayer: window.dataLayer
            };

            // Display pretty JSON in the consoleOutput div
            const formattedData = JSON.stringify(dataLayerEvent, null, 2);

            document.getElementById('consoleOutput').innerHTML = `
                <div class="heading">DataLayer - CAPI Page View</div>
                <div class="dotted-line"></div>
                <pre>${formattedData}</pre>
            `;
        }

        function submitHandler(event) {
            event.preventDefault();
            let formData = '';
            const elements = event.target.elements;
            for (let i = 0; i < elements.length; i++) {
                const element = elements[i];
                if (element.name) {
                    formData += `${element.name}: ${element.value}\n`;
                }
            }

            // Log form data to the console
            console.log("Form data submitted:");
            console.log(formData);

            // Display the form data in the consoleOutput div
            document.getElementById('consoleOutput').textContent = formData;
        }

        window.onload = function() {
            setLiFatId();
            updateHashedEmail();
            displayDataLayer(); // Display DataLayer with CAPI Page View on page load
        };
    </script>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MM6N3HBJ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <h2>CAPI Demo Form</h2>
    <form id="capiDemoForm" name="capiDemoForm" action="/submit" method="POST" onsubmit="submitHandler(event);" onreset="setLiFatId();" autocomplete="off">
        <label for="li_fat_id"><strong>li_fat_id:</strong></label>
        <input type="text" id="li_fat_id" name="li_fat_id" readonly autocomplete="off"><br><br>

        <label for="first_name"><strong>First Name:</strong></label>
        <input type="text" id="first_name" name="first_name" value="John" required autocomplete="off"><br><br>
        
        <label for="last_name"><strong>Last Name:</strong></label>
        <input type="text" id="last_name" name="last_name" value="Doe" required autocomplete="off"><br><br>
        
        <label for="email"><strong>Email:</strong></label>
        <input type="email" id="email" name="email" value="example@email.com" required oninput="updateHashedEmail()" autocomplete="off"><br><br>
        
        <label for="hashed_email"><strong>Hashed Email (SHA-256):</strong></label>
        <input type="text" id="hashed_email" name="hashed_email" readonly size="64" autocomplete="off"><br><br>

        <label for="job_title"><strong>Job Title:</strong></label>
        <input type="text" id="job_title" name="job_title" value="Software Engineer" required autocomplete="off"><br><br>

        <label for="company"><strong>Company:</strong></label>
        <input type="text" id="company" name="company" value="Example Corp" required autocomplete="off"><br><br>

        <label for="country_code"><strong>Country Code:</strong></label>
        <input type="text" id="country_code" name="country_code" value="US" required autocomplete="off"><br><br>

        <label for="currency"><strong>Currency:</strong></label>
        <input type="text" id="currency" name="currency" value="USD" required autocomplete="off"><br><br>

        <label for="value"><strong>Value:</strong></label>
        <input type="number" id="value" name="value" value="100.0" required autocomplete="off"><br><br>

        <label for="acxiom_id"><strong>Acxiom ID:</strong></label>
        <input type="text" id="acxiom_id" name="acxiom_id" value="AX123456" required autocomplete="off"><br><br>

        <label for="oracle_moat_id"><strong>Oracle Moat ID:</strong></label>
        <input type="text" id="oracle_moat_id" name="oracle_moat_id" value="MOAT98765" required autocomplete="off"><br><br>

        <label for="phone"><strong>Phone Number:</strong></label>
        <input type="tel" id="phone" name="phone" value="1234567890" required autocomplete="off"><br><br>
        
        <input type="submit" value="Submit">
        <input type="reset" value="Reset">

        <div id="consoleOutput"></div>
        <button type="button" onclick="clearConsoleOutput()">Clear Console Output</button>

    </form>
</body>
</html>
